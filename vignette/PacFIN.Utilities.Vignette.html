<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Andi Stephens" />

<meta name="date" content="2020-12-02" />

<title>PacFIN Utilities</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>
<style type="text/css">
a.anchor-section {margin-left: 10px; visibility: hidden; color: inherit;}
a.anchor-section::before {content: '#';}
.hasAnchor:hover a.anchor-section {visibility: visible;}
</style>
<script>// Anchor sections v1.0 written by Atsushi Yasumoto on Oct 3rd, 2020.
document.addEventListener('DOMContentLoaded', function() {
  // Do nothing if AnchorJS is used
  if (typeof window.anchors === 'object' && anchors.hasOwnProperty('hasAnchorJSLink')) {
    return;
  }

  const h = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

  // Do nothing if sections are already anchored
  if (Array.from(h).some(x => x.classList.contains('hasAnchor'))) {
    return null;
  }

  // Use section id when pandoc runs with --section-divs
  const section_id = function(x) {
    return ((x.classList.contains('section') || (x.tagName === 'SECTION'))
            ? x.id : '');
  };

  // Add anchors
  h.forEach(function(x) {
    const id = x.id || section_id(x.parentElement);
    if (id === '') {
      return null;
    }
    let anchor = document.createElement('a');
    anchor.href = '#' + id;
    anchor.classList = ['anchor-section'];
    x.classList.add('hasAnchor');
    x.appendChild(anchor);
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>





<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">PacFIN Utilities</h1>
<h4 class="author">Andi Stephens</h4>
<h4 class="date">2020-12-02</h4>



<p>The PacFIN.Utilites package provides functions for filtering, summarizing, expanding, and compiling composition data, and writing out the final products: length- age- and age-at-length compositions.</p>
<div id="workflow" class="section level3">
<h3>Workflow</h3>
<p>There are 15 functions in this package, and they are sensitive to the order in which they are run.</p>
<p>You can see a diagram of the workflow you can expect to follow in the help file:</p>
<pre><code>                   help(Workflow)</code></pre>
<p>as well as further information about interdependencies.</p>
</div>
<div id="saving" class="section level3">
<h3>Saving</h3>
<p>Many of the functions described below write summary output to the console, and several create plots for visualizing data at various steps in processing. The information written to the console can be captured using the sink function to encapsulate your workflow:</p>
<pre><code>                   sink(&quot;myfilename.txt&quot;, split=TRUE)

                   ... run some functions ...

                   sink()</code></pre>
</div>
<div id="functions" class="section level3">
<h3>Functions</h3>
<table>
<colgroup>
<col width="40%"></col>
<col width="30%"></col>
<col width="28%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Role</th>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Visualization</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">plotRawData</td>
<td align="left">Plots raw PacFIN data</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">plotCleaned</td>
<td align="left">Plots the product of cleanPacFIN similarly</td>
</tr>
<tr class="even">
<td align="left">Filtering</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">cleanPacFIN</td>
<td align="left">Filters raw PacFIN data</td>
</tr>
<tr class="even">
<td align="left">Customizing</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">combineCalCom</td>
<td align="left">Combines PacFIN and CalCOM data</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">setSeason</td>
<td align="left">Treating data from seasonal fisheries (e.g., petrale)</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Stratify</td>
<td align="left">Encoding the values in a column to a subset</td>
</tr>
<tr class="even">
<td align="left">Expansion</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">getExpansion_1</td>
<td align="left">The sample-to-tow expansion</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">getExpansion_2</td>
<td align="left">The tow-to-stratum expansion</td>
</tr>
<tr class="odd">
<td align="left">Composition</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">getComps</td>
<td align="left">Create stratified compositions</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">applySexRatio</td>
<td align="left">Distribute unsexed fish as males and females</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">writeComps</td>
<td align="left">Write out the stratified, sexed compositions</td>
</tr>
<tr class="odd">
<td align="left">Optional</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">getState</td>
<td align="left">‘state’ is initialized by cleanPacFIN</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">getGearGroup</td>
<td align="left">‘geargroup’ is initialized by cleanPacFIN</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">capValues</td>
<td align="left">caps the maximum value in a vector</td>
</tr>
<tr class="odd">
<td align="left">_______________________</td>
<td align="left">________________________</td>
<td align="left">________________________________________________</td>
</tr>
</tbody>
</table>
</div>
<div id="notes-on-expansions" class="section level3">
<h3>Notes on expansions</h3>
<p>There is one manual step in the workflow.</p>
<p>After running the expansion functions, data columns Expansion_Factor_1 and Expansion_Factor_2 are available to use in <strong>manually</strong> setting the Final_Expansion_Factor.</p>
<ul>
<li><p>WA fish are expanded using only Expansion_Factor_2.</p></li>
<li><p>Other expansions are the product of Expansion_Factor_1 * Expansion_Factor_2</p></li>
<li><p>Age data are expanded separately from lengths.</p></li>
<li><p>For age-at-length comps, set Final_Expansion_Factor to 1. Each fish represents only itself.</p></li>
</ul>
<p>Finally, the getExpansion_1 function has a “plot” argument to create plots documenting the expansions it creates. It also writes summary output to the console.</p>
<div id="please-report-bugs-or-send-suggestions-to-andi.stephensnoaa.gov.-thanks" class="section level4">
<h4>Please report bugs or send suggestions to: <a href="mailto:Andi.Stephens@noaa.gov" class="email">Andi.Stephens@noaa.gov</a>. Thanks!</h4>
</div>
</div>
<div id="section" class="section level2">
<h2>———–</h2>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
